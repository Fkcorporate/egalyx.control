{% extends "base.html" %}

{% block content %}
<div class="page-header-modern" style="background: linear-gradient(135deg, var(--fk-navy) 0%, var(--fk-blue) 100%); color: white; padding: 2.5rem 0;">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col">
                <div class="d-flex align-items-center">
                    <div class="header-icon" style="background: rgba(255,255,255,0.15); width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-calendar-alt fa-xl"></i>
                    </div>
                    <div class="header-content ms-4">
                        <nav aria-label="breadcrumb" class="mb-2">
                            <ol class="breadcrumb" style="background: transparent; padding: 0;">
                                <li class="breadcrumb-item">
                                    <a href="{{ url_for('liste_cartographies') }}" class="text-white opacity-75 hover-opacity-100 text-decoration-none">
                                        <i class="fas fa-map me-1"></i>Cartographies
                                    </a>
                                </li>
                                <li class="breadcrumb-item">
                                    <a href="{{ url_for('detail_cartographie', id=cartographie.id) }}" class="text-white opacity-75 hover-opacity-100 text-decoration-none">
                                        {{ cartographie.nom|truncate(30) }}
                                    </a>
                                </li>
                                <li class="breadcrumb-item active text-white" aria-current="page">Campagnes</li>
                            </ol>
                        </nav>
                        <div class="d-flex align-items-center gap-3">
                            <h1 class="page-title mb-0" style="color: white; font-weight: 700; font-size: 2rem;">
                                Campagnes d'évaluation
                            </h1>
                            <span class="badge fk-badge-primary" style="font-size: 0.85rem; padding: 0.5rem 1rem;">
                                <i class="fas fa-calendar-check me-1"></i>{{ cartographie.nom|truncate(20) }}
                            </span>
                        </div>
                        <p class="page-subtitle mt-2 mb-0" style="color: rgba(255,255,255,0.85); font-size: 1rem;">
                            <i class="fas fa-info-circle me-1"></i>Gestion des campagnes d'évaluation des risques
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-auto">
                <div class="d-flex flex-column gap-3">
                    <a href="{{ url_for('detail_cartographie', id=cartographie.id) }}" class="btn btn-outline-light d-flex align-items-center gap-2" style="border-radius: 8px; padding: 0.75rem 1.5rem; border-width: 2px;">
                        <i class="fas fa-arrow-left"></i>
                        <span>Retour à la cartographie</span>
                    </a>
                    <div class="text-center">
                        <small class="text-white opacity-75">
                            <i class="fas fa-clock me-1"></i>Mis à jour aujourd'hui
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid mt-4">
    <!-- Statistiques avec design moderne -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="row g-3">
                <div class="col-md-3">
                    <div class="fk-card h-100 hover-lift" style="border-left: 4px solid var(--fk-accent);">
                        <div class="fk-card-body d-flex align-items-center p-4">
                            <div class="flex-shrink-0">
                                <div class="rounded-circle p-3" style="background: linear-gradient(135deg, rgba(26, 60, 107, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);">
                                    <i class="fas fa-calendar fa-2x" style="color: var(--fk-accent);"></i>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-4">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="text-muted mb-1">Campagnes actives</div>
                                        <h3 class="mb-0" style="color: var(--fk-navy); font-weight: 700;">{{ stats.total }}</h3>
                                    </div>
                                    <div class="text-success">
                                        <i class="fas fa-arrow-up fa-sm"></i>
                                        <small>100%</small>
                                    </div>
                                </div>
                                <div class="progress mt-3" style="height: 6px;">
                                    <div class="progress-bar" style="background-color: var(--fk-accent); width: 100%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="fk-card h-100 hover-lift" style="border-left: 4px solid var(--fk-success);">
                        <div class="fk-card-body d-flex align-items-center p-4">
                            <div class="flex-shrink-0">
                                <div class="rounded-circle p-3" style="background: linear-gradient(135deg, rgba(13, 148, 136, 0.1) 0%, rgba(52, 211, 153, 0.1) 100%);">
                                    <i class="fas fa-play-circle fa-2x" style="color: var(--fk-success);"></i>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-4">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="text-muted mb-1">En cours</div>
                                        <h3 class="mb-0" style="color: var(--fk-navy); font-weight: 700;">{{ stats.en_cours }}</h3>
                                    </div>
                                </div>
                                <div class="progress mt-3" style="height: 6px;">
                                    <div class="progress-bar" style="background-color: var(--fk-success); width: {{ (stats.en_cours / stats.total * 100)|default(0) }}%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="fk-card h-100 hover-lift" style="border-left: 4px solid var(--fk-steel);">
                        <div class="fk-card-body d-flex align-items-center p-4">
                            <div class="flex-shrink-0">
                                <div class="rounded-circle p-3" style="background: linear-gradient(135deg, rgba(51, 65, 85, 0.1) 0%, rgba(148, 163, 184, 0.1) 100%);">
                                    <i class="fas fa-check-circle fa-2x" style="color: var(--fk-steel);"></i>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-4">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="text-muted mb-1">Terminées</div>
                                        <h3 class="mb-0" style="color: var(--fk-navy); font-weight: 700;">{{ stats.terminees }}</h3>
                                    </div>
                                </div>
                                <div class="progress mt-3" style="height: 6px;">
                                    <div class="progress-bar" style="background-color: var(--fk-steel); width: {{ (stats.terminees / stats.total * 100)|default(0) }}%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="fk-card h-100 hover-lift" style="border-left: 4px solid var(--fk-warning);">
                        <div class="fk-card-body d-flex align-items-center p-4">
                            <div class="flex-shrink-0">
                                <div class="rounded-circle p-3" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(251, 191, 36, 0.1) 100%);">
                                    <i class="fas fa-archive fa-2x" style="color: var(--fk-warning);"></i>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-4">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="text-muted mb-1">Archivées</div>
                                        <h3 class="mb-0" style="color: var(--fk-navy); font-weight: 700;">{{ stats.archives }}</h3>
                                    </div>
                                </div>
                                <div class="progress mt-3" style="height: 6px;">
                                    <div class="progress-bar" style="background-color: var(--fk-warning); width: {{ (stats.archives / stats.total * 100)|default(0) }}%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Barre d'actions et filtres -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="fk-card">
                <div class="fk-card-body p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center gap-3">
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary d-flex align-items-center gap-2" type="button" data-bs-toggle="dropdown" style="border-radius: 8px; padding: 0.75rem 1.25rem;">
                                    <i class="fas fa-filter"></i>
                                    <span>Filtres</span>
                                    <i class="fas fa-chevron-down ms-1"></i>
                                </button>
                                <div class="dropdown-menu p-3" style="min-width: 300px;">
                                    <div class="mb-3">
                                        <label class="form-label small text-muted mb-2">Statut</label>
                                        <select class="form-select form-select-sm" onchange="filtrerParStatut(this.value)">
                                            <option value="tous">Tous les statuts</option>
                                            <option value="en_cours">En cours</option>
                                            <option value="terminee">Terminée</option>
                                            <option value="planifiee">Planifiée</option>
                                            <option value="suspendue">Suspendue</option>
                                            <option value="archivee">Archivée</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small text-muted mb-2">Tri par</label>
                                        <select class="form-select form-select-sm" onchange="trierCampagnes(this.value)">
                                            <option value="date_desc">Date récente</option>
                                            <option value="date_asc">Date ancienne</option>
                                            <option value="nom">Nom A-Z</option>
                                            <option value="progression_desc">Progression ▼</option>
                                            <option value="progression_asc">Progression ▲</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="form-label small text-muted mb-2">Recherche</label>
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text bg-light"><i class="fas fa-search"></i></span>
                                            <input type="text" class="form-control" placeholder="Nom de campagne..." 
                                                   onkeyup="rechercherCampagne(this.value)">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Vue archives/actives -->
                            {% if voir_archives %}
                            <a href="{{ url_for('liste_campagnes_cartographie', cartographie_id=cartographie.id) }}" 
                               class="btn btn-success d-flex align-items-center gap-2" style="border-radius: 8px; padding: 0.75rem 1.25rem;">
                                <i class="fas fa-eye"></i>
                                <span>Voir les actives</span>
                            </a>
                            {% else %}
                            <a href="{{ url_for('liste_campagnes_cartographie', cartographie_id=cartographie.id, archives='oui') }}" 
                               class="btn btn-warning d-flex align-items-center gap-2 position-relative" style="border-radius: 8px; padding: 0.75rem 1.25rem;">
                                <i class="fas fa-archive"></i>
                                <span>Voir les archives</span>
                                {% if stats.archives > 0 %}
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size: 0.6rem; padding: 0.25rem 0.4rem;">
                                    {{ stats.archives }}
                                </span>
                                {% endif %}
                            </a>
                            {% endif %}
                        </div>
                        
                        <div class="d-flex gap-3">
                            {% if campagnes_data %}
                            <div class="input-group" style="max-width: 300px;">
                                <span class="input-group-text bg-light border-end-0"><i class="fas fa-search"></i></span>
                                <input type="text" class="form-control border-start-0" placeholder="Rechercher une campagne..." 
                                       onkeyup="rechercherCampagne(this.value)">
                            </div>
                            {% endif %}
                            
                            <button class="btn fk-btn-primary d-flex align-items-center gap-2" onclick="ouvrirModalNouvelleCampagne()" style="border-radius: 8px; padding: 0.75rem 1.5rem;">
                                <i class="fas fa-plus"></i>
                                <span>Nouvelle campagne</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tableau des campagnes -->
    <div class="row">
        <div class="col-12">
            <div class="fk-card">
                <div class="fk-card-header d-flex justify-content-between align-items-center" style="background: linear-gradient(135deg, var(--fk-navy) 0%, var(--fk-blue) 100%); padding: 1.5rem;">
                    <div class="d-flex align-items-center gap-3">
                        <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-list text-white"></i>
                        </div>
                        <div>
                            <h5 class="mb-0 text-white">
                                {% if voir_archives %}
                                <i class="fas fa-archive me-2"></i>Campagnes archivées
                                {% else %}
                                <i class="fas fa-calendar-alt me-2"></i>Campagnes d'évaluation
                                {% endif %}
                            </h5>
                            <small class="text-white opacity-75">
                                {{ campagnes_data|length }} campagne(s) trouvée(s)
                            </small>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <!-- Bouton d'export PDF pour toutes les campagnes -->
                        <div class="dropdown">
                            <button class="btn btn-outline-light dropdown-toggle d-flex align-items-center gap-2" 
                                    type="button" data-bs-toggle="dropdown"
                                    style="border-radius: 8px; padding: 0.5rem 1rem;">
                                <i class="fas fa-file-pdf text-danger"></i>
                                <span>Rapports PDF</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                    <a class="dropdown-item" href="#" onclick="genererRapportToutesCampagnes()">
                                        <i class="fas fa-file-pdf me-2 text-danger"></i>Toutes les campagnes
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <span class="dropdown-header">Campagnes disponibles</span>
                                </li>
                                {% for data in campagnes_data %}
                                <li>
                                    <a class="dropdown-item" href="{{ url_for('telecharger_rapport_cartographie_pdf_campagne', cartographie_id=cartographie.id, campagne_id=data.campagne.id) }}" 
                                       target="_blank">
                                        <i class="fas fa-file-pdf me-2 text-danger"></i>
                                        {{ data.campagne.nom|truncate(25) }}
                                        <span class="badge bg-secondary ms-2">{{ data.progression|round|int }}%</span>
                                    </a>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        
                        {% if voir_archives and campagnes_data|length > 0 and (current_user.role == 'admin' or current_user.is_client_admin) %}
                        <div class="dropdown">
                            <button class="btn btn-outline-light dropdown-toggle d-flex align-items-center gap-2" 
                                    type="button" data-bs-toggle="dropdown"
                                    style="border-radius: 8px; padding: 0.5rem 1rem;">
                                <i class="fas fa-ellipsis-h"></i>
                                <span>Actions</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                    <form method="POST" action="{{ url_for('supprimer_toutes_campagnes_archivees', cartographie_id=cartographie.id) }}" 
                                          class="dropdown-item p-0">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        <button type="submit" class="dropdown-item text-danger"
                                                onclick="return confirm('ATTENTION: Cette action supprimera définitivement TOUTES les campagnes archivées. Êtes-vous sûr ?')">
                                            <i class="fas fa-trash me-2"></i>Vider les archives
                                        </button>
                                    </form>
                                </li>
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="fk-card-body p-0">
                    {% if campagnes_data %}
                    <div class="table-responsive">
                        <table class="table table-hover mb-0" id="tableCampagnes">
                            <thead>
                                <tr style="background-color: #f8fafc;">
                                    <th class="py-3 px-4 border-bottom" style="font-weight: 600; color: var(--fk-navy);">Nom de la campagne</th>
                                    <th class="py-3 px-4 border-bottom" style="font-weight: 600; color: var(--fk-navy);">Statut</th>
                                    <th class="py-3 px-4 border-bottom" style="font-weight: 600; color: var(--fk-navy);">Période</th>
                                    <th class="py-3 px-4 border-bottom" style="font-weight: 600; color: var(--fk-navy);">Progression</th>
                                    <th class="py-3 px-4 border-bottom" style="font-weight: 600; color: var(--fk-navy);">Risques</th>
                                    <th class="py-3 px-4 border-bottom" style="font-weight: 600; color: var(--fk-navy);">Création</th>
                                    <th class="py-3 px-4 border-bottom text-end" style="font-weight: 600; color: var(--fk-navy);">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for data in campagnes_data %}
                                <tr class="campagne-row {% if data.est_active %}table-active{% endif %} {% if data.campagne.statut == 'archivee' %}table-secondary{% endif %}"
                                    data-statut="{{ data.campagne.statut }}"
                                    data-progression="{{ data.progression }}"
                                    data-nom="{{ data.campagne.nom|lower }}">
                                    <td class="py-3 px-4">
                                        <div class="d-flex align-items-start">
                                            <div class="flex-shrink-0">
                                                <div class="campagne-icon" style="width: 40px; height: 40px; background: linear-gradient(135deg, var(--fk-accent) 0%, var(--fk-light-blue) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; margin-right: 1rem;">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </div>
                                            </div>
                                            <div class="flex-grow-1">
                                                <div class="d-flex align-items-center gap-2 mb-1">
                                                    <strong class="campagne-nom" style="color: var(--fk-navy);">{{ data.campagne.nom }}</strong>
                                                    {% if data.est_active %}
                                                    <span class="badge fk-badge-success" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">
                                                        <i class="fas fa-bolt fa-xs me-1"></i>Active
                                                    </span>
                                                    {% endif %}
                                                    
                                                    {% if data.campagne.statut == 'archivee' %}
                                                    <span class="badge bg-secondary" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">
                                                        <i class="fas fa-archive fa-xs me-1"></i>Archivée
                                                    </span>
                                                    {% endif %}
                                                </div>
                                                {% if data.campagne.description %}
                                                <p class="mb-0 text-muted" style="font-size: 0.85rem; line-height: 1.4;">
                                                    {{ data.campagne.description|truncate(60) }}
                                                </p>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </td>
                                    
                                    <td class="py-3 px-4">
                                        {% if data.campagne.statut == 'en_cours' %}
                                        <span class="badge fk-badge-success d-inline-flex align-items-center gap-1">
                                            <i class="fas fa-play fa-xs"></i> En cours
                                        </span>
                                        {% elif data.campagne.statut == 'terminee' %}
                                        <span class="badge fk-badge-secondary d-inline-flex align-items-center gap-1">
                                            <i class="fas fa-check fa-xs"></i> Terminée
                                        </span>
                                        {% elif data.campagne.statut == 'planifiee' %}
                                        <span class="badge bg-info d-inline-flex align-items-center gap-1">
                                            <i class="fas fa-clock fa-xs"></i> Planifiée
                                        </span>
                                        {% elif data.campagne.statut == 'suspendue' %}
                                        <span class="badge bg-warning d-inline-flex align-items-center gap-1">
                                            <i class="fas fa-pause fa-xs"></i> Suspendue
                                        </span>
                                        {% elif data.campagne.statut == 'archivee' %}
                                        <span class="badge bg-dark d-inline-flex align-items-center gap-1">
                                            <i class="fas fa-archive fa-xs"></i> Archivée
                                        </span>
                                        {% else %}
                                        <span class="badge bg-light text-dark">{{ data.campagne.statut }}</span>
                                        {% endif %}
                                    </td>
                                    
                                    <td class="py-3 px-4">
                                        <div class="d-flex flex-column">
                                            {% if data.campagne.date_debut %}
                                            <div class="d-flex align-items-center gap-1 mb-1">
                                                <i class="fas fa-play text-success fa-xs"></i>
                                                <span class="small" style="color: var(--fk-steel);">
                                                    {{ data.campagne.date_debut.strftime('%d/%m/%Y') }}
                                                </span>
                                            </div>
                                            {% endif %}
                                            {% if data.campagne.date_fin %}
                                            <div class="d-flex align-items-center gap-1">
                                                <i class="fas fa-stop text-danger fa-xs"></i>
                                                <span class="small" style="color: var(--fk-steel);">
                                                    {{ data.campagne.date_fin.strftime('%d/%m/%Y') }}
                                                </span>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </td>
                                    
                                    <td class="py-3 px-4">
                                        <div class="d-flex align-items-center gap-3">
                                            <div class="flex-grow-1">
                                                <div class="progress" style="height: 8px; border-radius: 4px;">
                                                    <div class="progress-bar 
                                                        {% if data.progression >= 80 %}bg-success
                                                        {% elif data.progression >= 50 %}bg-warning
                                                        {% else %}bg-danger{% endif %}" 
                                                        style="width: {{ data.progression }}%; border-radius: 4px;">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="fw-bold" style="color: var(--fk-navy); min-width: 45px;">
                                                {{ data.progression|round|int }}%
                                            </div>
                                        </div>
                                    </td>
                                    
                                    <td class="py-3 px-4">
                                        <div class="text-center">
                                            <div class="fw-bold" style="color: var(--fk-navy); font-size: 1.1rem;">
                                                {{ data.risques_evalues }}
                                            </div>
                                            <div class="small text-muted" style="font-size: 0.8rem;">
                                                / {{ data.total_risques }} total
                                            </div>
                                        </div>
                                    </td>
                                    
                                    <td class="py-3 px-4">
                                        <div class="small fw-medium" style="color: var(--fk-navy);">
                                            {{ data.campagne.created_at.strftime('%d/%m/%Y') if data.campagne.created_at else 'N/A' }}
                                        </div>
                                        {% if data.campagne.created_by %}
                                        <div class="small text-muted" style="font-size: 0.8rem;">
                                            <i class="fas fa-user fa-xs me-1"></i>
                                            {{ data.campagne.createur.username if data.campagne.createur else data.campagne.created_by }}
                                        </div>
                                        {% endif %}
                                    </td>
                                    
                                    <td class="py-3 px-4 text-end">
                                        <div class="d-flex justify-content-end gap-2">
                                            <!-- Boutons principaux -->
                                            <div class="btn-group btn-group-sm">
                                                <a href="{{ url_for('detail_cartographie', id=cartographie.id) }}?campagne={{ data.campagne.id }}" 
                                                   class="btn btn-outline-primary d-flex align-items-center" 
                                                   title="Utiliser cette campagne"
                                                   style="border-radius: 6px; padding: 0.375rem 0.75rem;">
                                                    <i class="fas fa-play"></i>
                                                </a>
                                                
                                                <!-- NOUVEAU BOUTON RAPPORT PDF -->
                                                <a href="{{ url_for('telecharger_rapport_cartographie_pdf_campagne', cartographie_id=cartographie.id, campagne_id=data.campagne.id) }}" 
                                                   class="btn btn-outline-danger d-flex align-items-center" 
                                                   title="Télécharger le rapport PDF"
                                                   target="_blank"
                                                   style="border-radius: 6px; padding: 0.375rem 0.75rem;">
                                                    <i class="fas fa-file-pdf"></i>
                                                </a>
                                                
                                                <a href="{{ url_for('modifier_campagne', campagne_id=data.campagne.id) }}" 
                                                   class="btn btn-outline-info d-flex align-items-center" 
                                                   title="Modifier"
                                                   style="border-radius: 6px; padding: 0.375rem 0.75rem;">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                
                                                {% if data.campagne.statut == 'en_cours' and data.campagne.statut != 'archivee' %}
                                                <a href="{{ url_for('evaluer_tous_risques', cartographie_id=cartographie.id, campagne_id=data.campagne.id) }}" 
                                                   class="btn btn-outline-warning d-flex align-items-center" 
                                                   title="Évaluer les risques"
                                                   style="border-radius: 6px; padding: 0.375rem 0.75rem;">
                                                    <i class="fas fa-chart-bar"></i>
                                                </a>
                                                {% endif %}
                                            </div>
                                            
                                            <!-- Menu déroulant pour actions supplémentaires -->
                                            <div class="dropdown">
                                                <button class="btn btn-outline-secondary btn-sm dropdown-toggle d-flex align-items-center" 
                                                        type="button" data-bs-toggle="dropdown"
                                                        title="Plus d'actions"
                                                        style="border-radius: 6px; padding: 0.375rem 0.75rem;">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </button>
                                                <ul class="dropdown-menu dropdown-menu-end">
                                                    <!-- Option : Clôturer si en cours -->
                                                    {% if data.campagne.statut == 'en_cours' and data.campagne.statut != 'archivee' %}
                                                    <li>
                                                        <a class="dropdown-item text-success" href="#" 
                                                           onclick="cloturerCampagne({{ data.campagne.id }}, '{{ data.campagne.nom }}')">
                                                            <i class="fas fa-check-circle me-2"></i>Clôturer la campagne
                                                        </a>
                                                    </li>
                                                    <li><hr class="dropdown-divider"></li>
                                                    {% endif %}
                                                    
                                                    <!-- Option : Rapport PDF (déjà présent mais ajouté aussi ici) -->
                                                    <li>
                                                        <a class="dropdown-item text-danger" 
                                                           href="{{ url_for('telecharger_rapport_cartographie_pdf_campagne', cartographie_id=cartographie.id, campagne_id=data.campagne.id) }}"
                                                           target="_blank">
                                                            <i class="fas fa-file-pdf me-2"></i>Télécharger rapport PDF
                                                        </a>
                                                    </li>
                                                    <li><hr class="dropdown-divider"></li>
                                                    
                                                    <!-- Option : Archiver/Désarchiver -->
                                                    {% if data.campagne.statut != 'archivee' %}
                                                    <li>
                                                        <form method="POST" action="{{ url_for('archiver_campagne', campagne_id=data.campagne.id) }}" class="m-0">
                                                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                                            <button type="submit" class="dropdown-item text-warning" 
                                                                    onclick="return confirm('Êtes-vous sûr de vouloir archiver la campagne « {{ data.campagne.nom }} » ?')">
                                                                <i class="fas fa-archive me-2"></i>Archiver
                                                            </button>
                                                        </form>
                                                    </li>
                                                    {% else %}
                                                    <li>
                                                        <form method="POST" action="{{ url_for('desarchiver_campagne', campagne_id=data.campagne.id) }}" class="m-0">
                                                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                                            <button type="submit" class="dropdown-item text-success" 
                                                                    onclick="return confirm('Êtes-vous sûr de vouloir désarchiver la campagne « {{ data.campagne.nom }} » ?')">
                                                                <i class="fas fa-box-open me-2"></i>Désarchiver
                                                            </button>
                                                        </form>
                                                    </li>
                                                    {% endif %}
                                                    
                                                    <!-- Option : Supprimer (admin seulement) -->
                                                    {% if current_user.role == 'admin' or current_user.is_client_admin %}
                                                    <li><hr class="dropdown-divider"></li>
                                                    <li>
                                                        <form method="POST" action="{{ url_for('supprimer_campagne', campagne_id=data.campagne.id) }}" class="m-0">
                                                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                                            <button type="submit" class="dropdown-item text-danger" 
                                                                    onclick="return confirm('ATTENTION: Cette action est irréversible. Toutes les évaluations associées seront perdues.\\n\\nÊtes-vous sûr de vouloir supprimer définitivement la campagne « {{ data.campagne.nom }} » ?')">
                                                                <i class="fas fa-trash me-2"></i>Supprimer définitivement
                                                            </button>
                                                        </form>
                                                    </li>
                                                    {% endif %}
                                                </ul>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    {% if campagnes_data|length > 10 %}
                    <div class="p-4 border-top">
                        <nav class="d-flex justify-content-center">
                            <ul class="pagination mb-0">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1">
                                        <i class="fas fa-chevron-left"></i>
                                    </a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">
                                        <i class="fas fa-chevron-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                    {% endif %}
                    
                    {% else %}
                    <!-- État vide -->
                    <div class="text-center py-5">
                        {% if voir_archives %}
                        <div class="mb-4">
                            <div class="rounded-circle mx-auto p-4" style="width: 120px; height: 120px; background: linear-gradient(135deg, rgba(51, 65, 85, 0.1) 0%, rgba(148, 163, 184, 0.1) 100%);">
                                <i class="fas fa-archive fa-3x" style="color: var(--fk-steel);"></i>
                            </div>
                        </div>
                        <h5 class="mb-2" style="color: var(--fk-navy);">Aucune campagne archivée</h5>
                        <p class="text-muted mb-4">Les campagnes archivées apparaîtront ici</p>
                        <a href="{{ url_for('liste_campagnes_cartographie', cartographie_id=cartographie.id) }}" 
                           class="btn fk-btn-outline">
                            <i class="fas fa-eye me-2"></i>Voir les campagnes actives
                        </a>
                        {% else %}
                        <div class="mb-4">
                            <div class="rounded-circle mx-auto p-4" style="width: 120px; height: 120px; background: linear-gradient(135deg, rgba(26, 60, 107, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);">
                                <i class="fas fa-calendar-alt fa-3x" style="color: var(--fk-accent);"></i>
                            </div>
                        </div>
                        <h5 class="mb-2" style="color: var(--fk-navy);">Aucune campagne d'évaluation</h5>
                        <p class="text-muted mb-4">Créez votre première campagne pour commencer l'évaluation des risques</p>
                        <button class="btn fk-btn-primary" onclick="ouvrirModalNouvelleCampagne()">
                            <i class="fas fa-calendar-plus me-2"></i> Créer une campagne
                        </button>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal pour nouvelle campagne -->
<div class="modal fade" id="modalNouvelleCampagne" tabindex="-1" aria-labelledby="modalNouvelleCampagneLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border: none; border-radius: 16px; overflow: hidden;">
            <div class="modal-header" style="background: linear-gradient(135deg, var(--fk-navy) 0%, var(--fk-blue) 100%); padding: 1.5rem 2rem;">
                <div class="d-flex align-items-center gap-3">
                    <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-calendar-plus text-white"></i>
                    </div>
                    <div>
                        <h5 class="modal-title mb-0 text-white">Nouvelle Campagne d'Évaluation</h5>
                        <small class="text-white opacity-75">Créez une nouvelle campagne pour {{ cartographie.nom }}</small>
                    </div>
                </div>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{{ url_for('nouvelle_campagne_cartographie', id=cartographie.id) }}">
                <div class="modal-body p-4">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <div class="row g-4">
                        <div class="col-12">
                            <label class="form-label fw-semibold" style="color: var(--fk-navy);">Nom de la campagne *</label>
                            <input type="text" class="form-control fk-form-control" name="nom" required
                                   placeholder="Ex: Évaluation annuelle 2025, Audit de conformité, Revue trimestrielle..."
                                   style="border-radius: 8px; padding: 0.875rem 1rem;">
                            <small class="text-muted">Donnez un nom clair et descriptif à votre campagne</small>
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label fw-semibold" style="color: var(--fk-navy);">Description (optionnel)</label>
                            <textarea class="form-control fk-form-control" name="description" rows="3"
                                      placeholder="Objectifs, contexte, périmètre, participants..."
                                      style="border-radius: 8px; padding: 0.875rem 1rem;"></textarea>
                        </div>
                        
                        <div class="col-12">
                            <div class="fk-alert fk-alert-info" style="border-radius: 12px;">
                                <i class="fas fa-info-circle" style="color: var(--fk-accent);"></i>
                                <div class="flex-grow-1">
                                    <div class="fw-semibold" style="color: var(--fk-navy);">Information importante</div>
                                    <div class="small" style="color: var(--fk-steel);">
                                        Vous pourrez définir les dates, périodes et paramètres avancés après la création de la campagne.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer p-4 border-top" style="background-color: #f8fafc;">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" 
                            style="border-radius: 8px; padding: 0.75rem 1.5rem; border-width: 2px;">
                        Annuler
                    </button>
                    <button type="submit" class="btn fk-btn-primary" 
                            style="border-radius: 8px; padding: 0.75rem 1.5rem;">
                        <i class="fas fa-plus me-2"></i>Créer la campagne
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal confirmation clôture -->
<div class="modal fade" id="modalClotureCampagne" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 16px;">
            <div class="modal-header border-bottom-0 pb-0" style="padding: 1.5rem 1.5rem 0;">
                <div class="d-flex align-items-center gap-3">
                    <div class="rounded-circle p-3" style="background: linear-gradient(135deg, rgba(13, 148, 136, 0.1) 0%, rgba(52, 211, 153, 0.1) 100%);">
                        <i class="fas fa-check-circle fa-2x" style="color: var(--fk-success);"></i>
                    </div>
                    <div>
                        <h5 class="modal-title mb-0" style="color: var(--fk-navy);">Clôturer la campagne</h5>
                        <small class="text-muted">Confirmez la clôture de la campagne</small>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <p class="mb-3" style="color: var(--fk-steel);">
                    Êtes-vous sûr de vouloir clôturer la campagne <strong id="campagneNomCloture" style="color: var(--fk-navy);"></strong> ?
                </p>
                <div class="fk-alert fk-alert-warning" style="border-radius: 12px;">
                    <i class="fas fa-exclamation-triangle" style="color: var(--fk-warning);"></i>
                    <div class="flex-grow-1">
                        <div class="fw-semibold">Attention</div>
                        <div class="small">
                            Une fois clôturée, la campagne ne pourra plus être modifiée. Vous pourrez toujours consulter les évaluations effectuées.
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-top-0 pt-0" style="padding: 0 1.5rem 1.5rem;">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal"
                        style="border-radius: 8px; padding: 0.75rem 1.5rem; border-width: 2px;">
                    Annuler
                </button>
                <button type="button" class="btn fk-btn-success" id="btnConfirmerCloture"
                        style="border-radius: 8px; padding: 0.75rem 1.5rem;">
                    <i class="fas fa-check me-2"></i>Confirmer la clôture
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal pour générer rapport de toutes les campagnes -->
<div class="modal fade" id="modalRapportToutesCampagnes" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border: none; border-radius: 16px;">
            <div class="modal-header" style="background: linear-gradient(135deg, var(--fk-navy) 0%, var(--fk-blue) 100%);">
                <h5 class="modal-title text-white">
                    <i class="fas fa-file-pdf me-2"></i>Générer rapport consolidé
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <p>Cette fonctionnalité générera un rapport PDF consolidé de toutes les campagnes.</p>
                <div class="fk-alert fk-alert-info">
                    <i class="fas fa-info-circle"></i>
                    <span>Fonctionnalité en cours de développement</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Variables globales
let campagneClotureId = null;

// Fonctions de filtrage
function filtrerParStatut(statut) {
    const lignes = document.querySelectorAll('#tableCampagnes tbody tr.campagne-row');
    lignes.forEach(ligne => {
        const statutLigne = ligne.getAttribute('data-statut');
        const estVisible = (statut === 'tous' || statutLigne === statut);
        
        ligne.style.display = estVisible ? '' : 'none';
        
        // Animation
        if (estVisible) {
            ligne.style.opacity = '0';
            ligne.style.transform = 'translateY(10px)';
            setTimeout(() => {
                ligne.style.transition = 'all 0.3s ease';
                ligne.style.opacity = '1';
                ligne.style.transform = 'translateY(0)';
            }, 10);
        }
    });
}

function trierCampagnes(critere) {
    const tbody = document.querySelector('#tableCampagnes tbody');
    const lignes = Array.from(tbody.querySelectorAll('tr.campagne-row'));
    
    lignes.sort((a, b) => {
        switch(critere) {
            case 'date_desc':
                // À adapter selon vos données de date
                return 0;
            case 'date_asc':
                return 0;
            case 'nom':
                const nomA = a.getAttribute('data-nom');
                const nomB = b.getAttribute('data-nom');
                return nomA.localeCompare(nomB);
            case 'progression_desc':
                const progA = parseFloat(a.getAttribute('data-progression'));
                const progB = parseFloat(b.getAttribute('data-progression'));
                return progB - progA;
            case 'progression_asc':
                const progA2 = parseFloat(a.getAttribute('data-progression'));
                const progB2 = parseFloat(b.getAttribute('data-progression'));
                return progA2 - progB2;
            default:
                return 0;
        }
    });
    
    // Animer la réorganisation
    tbody.style.opacity = '0.5';
    setTimeout(() => {
        lignes.forEach(ligne => tbody.appendChild(ligne));
        tbody.style.opacity = '1';
        tbody.style.transition = 'opacity 0.3s ease';
    }, 300);
}

function rechercherCampagne(terme) {
    const lignes = document.querySelectorAll('#tableCampagnes tbody tr.campagne-row');
    const termeMin = terme.toLowerCase().trim();
    
    lignes.forEach((ligne, index) => {
        const nomLigne = ligne.getAttribute('data-nom');
        const estVisible = termeMin === '' || (nomLigne && nomLigne.includes(termeMin));
        
        ligne.style.display = estVisible ? '' : 'none';
        
        // Animation en cascade
        if (estVisible) {
            setTimeout(() => {
                ligne.style.opacity = '0';
                ligne.style.transform = 'translateY(10px)';
                ligne.style.transition = 'all 0.3s ease';
                
                setTimeout(() => {
                    ligne.style.opacity = '1';
                    ligne.style.transform = 'translateY(0)';
                }, 10);
            }, index * 50);
        }
    });
}

// Fonctions de gestion des campagnes
function ouvrirModalNouvelleCampagne() {
    const modal = new bootstrap.Modal(document.getElementById('modalNouvelleCampagne'));
    modal.show();
    
    // Focus sur le premier champ
    setTimeout(() => {
        document.querySelector('#modalNouvelleCampagne input[name="nom"]').focus();
    }, 500);
}

function cloturerCampagne(campagneId, campagneNom) {
    campagneClotureId = campagneId;
    document.getElementById('campagneNomCloture').textContent = campagneNom;
    
    const modal = new bootstrap.Modal(document.getElementById('modalClotureCampagne'));
    modal.show();
}

function genererRapportToutesCampagnes() {
    const modal = new bootstrap.Modal(document.getElementById('modalRapportToutesCampagnes'));
    modal.show();
}

// Configuration du bouton de clôture
document.getElementById('btnConfirmerCloture').addEventListener('click', function() {
    if (campagneClotureId) {
        window.location.href = `/cartographie/{{ cartographie.id }}/cloturer-campagne/${campagneClotureId}`;
    }
});

// Initialisation
document.addEventListener('DOMContentLoaded', function() {
    // Initialiser les tooltips Bootstrap
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'));
    tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl, {
            delay: { show: 500, hide: 100 }
        });
    });
    
    // Mettre en évidence les campagnes actives
    const lignesActives = document.querySelectorAll('tr.table-active');
    lignesActives.forEach(ligne => {
        ligne.style.boxShadow = 'inset 0 0 0 2px var(--fk-accent)';
        ligne.style.transition = 'box-shadow 0.3s ease';
    });
    
    // Animation d'entrée pour les cartes statistiques
    const statCards = document.querySelectorAll('.fk-card');
    statCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 150);
    });
    
    // Hover effects pour les lignes du tableau
    const tableRows = document.querySelectorAll('#tableCampagnes tbody tr');
    tableRows.forEach(row => {
        row.addEventListener('mouseenter', function() {
            this.style.backgroundColor = 'rgba(59, 130, 246, 0.05)';
            this.style.transition = 'background-color 0.2s ease';
        });
        
        row.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '';
        });
    });
    
    // Animation pour les badges de statut
    const badges = document.querySelectorAll('.badge');
    badges.forEach(badge => {
        badge.style.transform = 'scale(0.95)';
        setTimeout(() => {
            badge.style.transition = 'transform 0.3s ease';
            badge.style.transform = 'scale(1)';
        }, 300);
    });
});

// Fonction pour exporter les données
function exporterCampagnes() {
    showToast('Export des campagnes en cours...', 'info');
    // Implémentez l'export ici
}

// Fonction pour imprimer la liste
function imprimerListeCampagnes() {
    window.print();
}

// Gestion des événements clavier
document.addEventListener('keydown', function(e) {
    // Ctrl + N pour nouvelle campagne
    if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
        e.preventDefault();
        ouvrirModalNouvelleCampagne();
    }
    
    // Ctrl + F pour rechercher
    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
        e.preventDefault();
        const searchInput = document.querySelector('input[placeholder*="Rechercher"]');
        if (searchInput) {
            searchInput.focus();
            searchInput.select();
        }
    }
});

// Fonction pour afficher des notifications toast
function showToast(message, type = 'info') {
    // Implémentez votre système de toast ici
    console.log(`[${type}] ${message}`);
}
</script>

<style>
/* Styles spécifiques pour la page campagnes */

/* Animation hover lift */
.hover-lift {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.hover-lift:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1), 0 6px 12px rgba(0, 0, 0, 0.08) !important;
}

/* Animation de pulse pour les éléments importants */
@keyframes pulse-gentle {
    0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
    70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
    100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
}

.pulse {
    animation: pulse-gentle 2s infinite;
}

/* Styles pour les lignes actives */
tr.table-active {
    position: relative;
}

tr.table-active::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: linear-gradient(to bottom, var(--fk-accent), var(--fk-light-blue));
    border-radius: 3px 0 0 3px;
}

/* Amélioration des progress bars */
.progress {
    overflow: hidden;
    background-color: #e2e8f0;
}

.progress-bar {
    transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255,255,255,0.3) 50%, 
        transparent 100%);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* Styles pour les badges de statut */
.badge {
    font-weight: 500;
    letter-spacing: 0.3px;
    transition: all 0.2s ease;
}

.badge:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Amélioration des boutons d'action */
.btn-group-sm .btn {
    border-radius: 6px;
    transition: all 0.2s ease;
}

.btn-group-sm .btn:hover {
    transform: translateY(-1px);
}

/* Styles pour les dropdowns */
.dropdown-menu {
    border: none;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1), 0 4px 20px rgba(0, 0, 0, 0.08);
    border-radius: 12px;
    overflow: hidden;
    margin-top: 8px !important;
}

.dropdown-item {
    padding: 0.75rem 1rem;
    transition: all 0.2s ease;
    border-radius: 0;
}

.dropdown-item:hover {
    background-color: #f1f5f9;
    transform: translateX(2px);
}

/* Styles pour les états vides */
.text-muted {
    color: #64748b !important;
}

/* Responsive amélioré */
@media (max-width: 768px) {
    .page-title {
        font-size: 1.5rem !important;
    }
    
    .fk-card-header {
        flex-direction: column;
        align-items: flex-start !important;
        gap: 1rem;
    }
    
    .fk-card-header > div:last-child {
        align-self: flex-end;
    }
    
    .table-responsive {
        font-size: 0.9rem;
    }
    
    .campagne-icon {
        display: none !important;
    }
    
    .btn-group {
        flex-wrap: wrap;
    }
    
    .dropdown-menu {
        position: fixed !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        width: 90vw;
        max-height: 80vh;
        overflow-y: auto;
    }
}

/* Animation d'entrée pour les modales */
.modal.fade .modal-content {
    transform: translateY(-50px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal.show .modal-content {
    transform: translateY(0);
    opacity: 1;
}

/* Scrollbar personnalisée */
.table-responsive::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

.table-responsive::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
}

.table-responsive::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 4px;
}

.table-responsive::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
}

/* Mode sombre */
[data-bs-theme="dark"] .fk-card {
    background: #1e293b;
}

[data-bs-theme="dark"] .campagne-nom {
    color: #e2e8f0 !important;
}

[data-bs-theme="dark"] .text-muted {
    color: #94a3b8 !important;
}

[data-bs-theme="dark"] .table th {
    color: #cbd5e1 !important;
}

[data-bs-theme="dark"] .progress {
    background-color: #334155;
}

[data-bs-theme="dark"] tr:hover {
    background-color: rgba(59, 130, 246, 0.1) !important;
}

[data-bs-theme="dark"] .modal-footer {
    background-color: #1e293b !important;
}

/* Animation pour les statistiques */
.stat-card-animation {
    animation: statCardFadeIn 0.6s ease-out forwards;
    opacity: 0;
}

@keyframes statCardFadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Éléments d'interface modernes */
.form-control:focus, .form-select:focus {
    border-color: var(--fk-accent);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    outline: none;
}

/* Boutons avec gradient moderne */
.btn-gradient {
    background: linear-gradient(135deg, var(--fk-accent) 0%, var(--fk-light-blue) 100%);
    border: none;
    color: white;
    transition: all 0.3s ease;
}

.btn-gradient:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
    color: white;
}

/* Badges avec effet de profondeur */
.badge-depth {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.2);
}

/* Transition douce pour les changements d'état */
.campagne-row {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
</style>
{% endblock %}
