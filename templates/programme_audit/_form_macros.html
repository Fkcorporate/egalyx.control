{% macro render_field(field, label_visible=true) -%}
    <div class="form-group {% if field.errors %}has-error{% endif %} {{ kwargs.pop('class_', '') }}">
        {% if field.type != 'HiddenField' and label_visible %}
            <label for="{{ field.id }}" class="form-label">
                {{ field.label.text }}
                {% if field.flags.required %}
                <span class="text-danger">*</span>
                {% endif %}
            </label>
        {% endif %}
        
        {% if field.type == 'BooleanField' %}
            <div class="form-check">
                {{ field(class_='form-check-input', **kwargs) }}
                <label class="form-check-label" for="{{ field.id }}">
                    {{ field.label.text }}
                </label>
            </div>
        {% elif field.type == 'RadioField' %}
            {% for subfield in field %}
            <div class="form-check">
                {{ subfield(class_='form-check-input') }}
                <label class="form-check-label" for="{{ subfield.id }}">
                    {{ subfield.label.text }}
                </label>
            </div>
            {% endfor %}
        {% elif field.type == 'SelectField' %}
            {{ field(class_='form-select' + (' is-invalid' if field.errors else ''), **kwargs)|safe }}
        {% elif field.type == 'SelectMultipleField' %}
            {{ field(class_='form-select' + (' is-invalid' if field.errors else ''), **kwargs)|safe }}
        {% elif field.type == 'TextAreaField' %}
            {{ field(class_='form-control' + (' is-invalid' if field.errors else ''), rows=kwargs.pop('rows', 3), **kwargs)|safe }}
        {% elif field.type == 'DateField' %}
            {{ field(class_='form-control datepicker' + (' is-invalid' if field.errors else ''), **kwargs)|safe }}
        {% else %}
            {{ field(class_='form-control' + (' is-invalid' if field.errors else ''), **kwargs)|safe }}
        {% endif %}
        
        {% if field.errors %}
            {% for e in field.errors %}
            <div class="invalid-feedback d-block">{{ e }}</div>
            {% endfor %}
        {% endif %}
        
        {% if field.description %}
        <small class="form-text text-muted">{{ field.description }}</small>
        {% endif %}
    </div>
{%- endmacro %}

{% macro render_submit(text='Enregistrer', class='btn-primary', icon='save') -%}
    <button type="submit" class="btn {{ class }}">
        {% if icon %}
        <i class="fas fa-{{ icon }} me-2"></i>
        {% endif %}
        {{ text }}
    </button>
{%- endmacro %}

{% macro render_cancel(url, text='Annuler', class='btn-secondary') -%}
    <a href="{{ url }}" class="btn {{ class }}">
        <i class="fas fa-times me-2"></i>
        {{ text }}
    </a>
{%- endmacro %}

{% macro render_form_errors(form) -%}
    {% if form.errors %}
    <div class="alert alert-danger">
        <h5><i class="fas fa-exclamation-triangle me-2"></i>Erreurs dans le formulaire</h5>
        <ul class="mb-0">
            {% for field, errors in form.errors.items() %}
                {% for error in errors %}
                <li>{{ form[field].label.text }}: {{ error }}</li>
                {% endfor %}
            {% endfor %}
        </ul>
    </div>
    {% endif %}
{%- endmacro %}

{% macro render_mandatory_fields_note() -%}
    <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        Les champs marqu√©s d'un <span class="text-danger">*</span> sont obligatoires.
    </div>
{%- endmacro %}